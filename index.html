<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mundos de IA - Universos Épicos</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Inter y Orbitron) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome para íconos -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"></script>
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Tone.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>

    <!-- Chosen Palette: Digital Aurora (Dark Blue/Purple base with Neon Green/Blue/Pink accents) -->
    <!-- Application Structure Plan: The application is a single-page, multi-section scrollable website. Navigation is handled by a fixed, dynamic header with smooth scrolling to relevant sections. This structure provides a continuous, immersive journey through the content. Submenus within the navigation enhance content organization and accessibility on both desktop and mobile. Interactive elements, including advanced animations (GSAP), dynamic 3D backgrounds (Three.js), reactive particle effects (Canvas), and subtle sound feedback (Tone.js), are integrated throughout. This design aims to create a highly engaging and immersive user experience, making the exploration of "AI Worlds" feel futuristic and dynamic. A new floating chatbot allows natural language interaction with an LLM, providing dynamic Q&A capabilities, now enhanced with context from the page content and a typewriter effect for responses. Form submission is handled via Formspree. -->
    <!-- Visualization & Content Choices: 
    1. Overall Navigation: Goal: Seamless exploration. Viz: Fixed navbar with smooth scroll and animated links. Interaction: Click/tap on links, mobile hamburger menu (now auto-closing), floating navigation arrows. Justification: Provides clear, persistent navigation with enhanced visual feedback and direct section control. Library: GSAP ScrollToPlugin, Vanilla JS, Font Awesome.
    2. Section Snapping: Goal: Immersive full-screen experience. Viz: Sections snap to full viewport height. Interaction: Scrolling. Justification: Ensures each section is viewed in its entirety, enhancing focus and visual impact. Library: CSS Scroll Snap, GSAP ScrollTrigger.
    3. Section Backgrounds: Goal: Immersive atmosphere. Viz: Dynamic particle effects (Canvas) for most sections, and an abstract 3D scene (Three.js) for the Home section. Interaction: Passive, reacts to mouse/touch movement. Justification: Enhances visual depth and reinforces the futuristic theme. Library: Vanilla JS Canvas, Three.js.
    4. Content Cards: Goal: Highlight key information. Viz: Glassmorphic styled cards with embedded dynamic canvas animations (mini-galaxy/star fields). Interaction: Hover effects (scale, rotate, shadow) and scroll-triggered animations. Justification: Adds visual interest and emphasizes content dynamically, making cards feel "alive" and unique. Library: Tailwind CSS, GSAP, Vanilla JS Canvas.
    5. "Imágenes IA" Gallery: Goal: Showcase AI-generated images interactively. Viz: Image carousel with navigation buttons. Interaction: Click next/prev buttons to cycle through images. Justification: Provides a more engaging way to view multiple image examples within a constrained space. Library: Vanilla JS, GSAP.
    6. "Resonancia Quiral" Quote: Goal: Dynamic engagement. Viz: Text block. Interaction: Button to generate new quote. Justification: Adds a small, delightful interactive element that encourages repeated engagement. Library: Vanilla JS.
    7. Form Feedback: Goal: User confirmation. Viz: Custom modal/message box. Interaction: Form submission. Justification: Replaces disruptive browser alerts with a smoother, integrated UI element. Library: Vanilla JS.
    8. Audio Feedback: Goal: Enhance immersion. Viz: Subtle sound effects. Interaction: Clicks on navigation, button presses, notification appearance, chatbot messages. Justification: Adds an auditory layer to the interactive experience. Library: Tone.js.
    9. Cursor Effect: Goal: Enhance interactivity. Viz: Animated cursor trail. Interaction: Mouse/touch movement. Justification: Provides continuous visual feedback and a sense of responsiveness. Library: Vanilla JS Canvas.
    10. Chatbot: Goal: Provide natural language interaction and information retrieval. Viz: Floating chat window with message display and input, with an animated eye icon. Interaction: User types messages, AI responds with a typewriter effect. Justification: Offers a direct, conversational way to explore the "AI Worlds" concept, now with enhanced contextual awareness of the page content and improved visual/auditory feedback. Library: Vanilla JS, Gemini API.
    11. Email Submission: Goal: Enable contact form submissions. Viz: Standard HTML form. Interaction: Form submission handled by Formspree. Justification: Provides a functional contact method without server-side code. Library: Formspree.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            background: #0a0a23;
            color: white;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            margin: 0;
            cursor: none; /* Hide default cursor */
            scroll-snap-type: y mandatory; /* Enable scroll snapping */
            scroll-behavior: smooth; /* Smooth scroll for snap */
            scroll-padding-top: 64px; /* Adjust for fixed navbar height */
        }
        .navbar {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            z-index: 1000;
            border-bottom: 2px solid rgba(0, 255, 136, 0.4);
            transition: background 0.3s ease, padding 0.3s ease;
        }
        .navbar.scrolled {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            background: rgba(0, 0, 0, 0.95);
        }
        .nav-links {
            position: relative;
        }
        .nav-item {
            position: relative;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        .nav-item:hover {
            transform: rotate(2deg) scale(1.05);
            color: #00ff88;
        }
        .nav-item a i {
            margin-right: 0.5rem;
            transition: transform 0.4s ease, color 0.3s ease;
        }
        .nav-item:hover a i, .nav-item.active a i {
            transform: rotate(180deg);
            color: #00ff88;
        }
        .submenu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            border-radius: 0.5rem;
            padding: 1rem;
            min-width: 220px;
            z-index: 10;
            transform: rotate(2deg);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .nav-item:hover .submenu {
            display: block;
            opacity: 1;
            pointer-events: auto;
            transform: rotate(0deg);
        }
        .submenu a {
            display: flex;
            align-items: center;
            padding: 0.5rem 0;
            color: white;
            text-decoration: none;
            font-size: calc(0.9rem + 0.5vw);
            transition: color 0.3s ease, transform 0.3s ease;
        }
        .submenu a:hover {
            color: #00ff88;
            transform: translateX(8px) rotate(-2deg);
        }
        .nav-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }
        .section {
            min-height: 100vh;
            padding: 5rem 2rem;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: background 1s ease;
            overflow: hidden; /* Ensure content doesn't overflow during animations */
            scroll-snap-align: start; /* Enable section snapping */
        }
        .sub-section {
            padding-top: 4rem;
            min-height: 40vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 800px;
        }
        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 136, 0.4);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            position: relative;
            z-index: 1;
            overflow: hidden; /* Ensure canvas inside doesn't overflow */
        }
        .card:hover {
            transform: translateY(-15px) rotate(4deg) scale(1.03);
            box-shadow: 0 15px 25px rgba(0, 255, 136, 0.4);
        }
        .section-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }
        #home .section-canvas {
            opacity: 1; /* Three.js scene will manage its own opacity */
        }
        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: calc(2rem + 1vw);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
            transform: rotate(-3deg);
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }
        .sub-section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: calc(1.2rem + 0.5vw);
            margin-bottom: 0.8rem;
            transform: rotate(2deg);
            position: relative;
            z-index: 1;
        }
        .gradient-text {
            background: linear-gradient(45deg, #00ff88, #007bff, #ff00cc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .wave-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(0, 255, 136, 0.4), transparent);
            opacity: 0;
            z-index: -1;
        }
        .pulse-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(0, 255, 136, 0.7), transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            z-index: -1;
        }
        /* Estilos por sección */
        #home { background: linear-gradient(135deg, #0a0a23, #1e3a8a); }
        #portfolio { background: linear-gradient(135deg, #1e3a8a, #4c1d95); }
        #process { background: linear-gradient(135deg, #4c1d95, #831843); }
        #contact { background: linear-gradient(135deg, #831843, #0a0a23); }

        .custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 9999;
            width: 20px;
            height: 20px;
            background-color: #00ff88;
            border-radius: 50%;
            opacity: 0.6;
            transform: translate(-50%, -50%);
            transition: width 0.2s ease, height 0.2s ease, opacity 0.2s ease;
        }
        .custom-cursor.active {
            width: 40px;
            height: 40px;
            opacity: 0.8;
        }

        /* Custom Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 255, 136, 0.6);
            border-radius: 1rem;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-50px) scale(0.8);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal-overlay.active .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        .modal-content h3 {
            font-family: 'Orbitron', sans-serif;
            color: #00ff88;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .modal-content p {
            color: white;
            margin-bottom: 1.5rem;
        }
        .modal-content button {
            background: #007bff;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background 0.3s ease;
        }
        .modal-content button:hover {
            background: #0056b3;
        }

        /* Floating Navigation Arrows */
        .nav-arrow {
            position: fixed;
            right: 2rem;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 255, 136, 0.5);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #00ff88;
            cursor: pointer;
            z-index: 900;
            transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
            opacity: 0; /* Hidden by default, controlled by JS */
            pointer-events: none; /* Disable interaction when hidden */
        }
        .nav-arrow:hover {
            background: rgba(0, 255, 136, 0.2);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.7);
            transform: scale(1.1);
        }
        .nav-arrow.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #arrow-up {
            bottom: 7rem; /* Adjust based on arrow-down position */
        }
        #arrow-down {
            bottom: 2rem;
        }

        /* Canvas for cards */
        .card-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Behind content */
            opacity: 0.2;
            border-radius: 1rem; /* Match card border-radius */
        }
        .card p, .card h3 {
            position: relative; /* Ensure text is above canvas */
            z-index: 1;
        }
        .card img {
            position: relative; /* Ensure image is above canvas */
            z-index: 1;
        }
        .image-gallery {
            position: relative;
            width: 100%;
            max-width: 400px; /* Adjust as needed */
            margin: 0 auto;
        }
        .gallery-image {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .gallery-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s ease;
            z-index: 2; /* Above image */
        }
        .gallery-nav-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        #prev-image {
            left: 0.5rem;
        }
        #next-image {
            right: 0.5rem;
        }
        .video-preview {
            position: relative;
            display: inline-block;
        }
        .video-preview .fa-play-circle {
            position: absolute;
            top: 1/2;
            left: 1/2;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: white;
            opacity: 0.75;
            transition: opacity 0.3s ease;
        }
        .video-preview:hover .fa-play-circle {
            opacity: 1;
        }

        /* Chatbot Styles */
        #chatbot-toggle-btn {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            background: #00ff88;
            color: #0a0a23;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.5);
            z-index: 1500;
            transition: transform 0.3s ease, background 0.3s ease;
        }
        #chatbot-toggle-btn:hover {
            transform: scale(1.1);
            background: #00e676;
        }
        #chatbot-toggle-btn i {
            animation: blink 2s infinite ease-in-out; /* Adjusted animation for clearer blink */
        }
        @keyframes blink {
            0% { opacity: 0.2; } /* Eye closed */
            49% { opacity: 0.2; } /* Stay closed */
            50% { opacity: 1; } /* Eye opens */
            51% { opacity: 1; } /* Stay open */
            100% { opacity: 0.2; } /* Closes again */
        }


        #chatbot-container {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 350px;
            height: 500px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(0, 255, 136, 0.6);
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.7);
            z-index: 1600;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateY(100%) scale(0.8);
            opacity: 0;
            pointer-events: none;
            transition: transform 0.4s ease, opacity 0.4s ease;
        }
        #chatbot-container.active {
            transform: translateY(0) scale(1);
            opacity: 1;
            pointer-events: auto;
        }

        #chatbot-header {
            background: rgba(0, 255, 136, 0.2);
            padding: 1rem;
            border-bottom: 1px solid rgba(0, 255, 136, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Orbitron', sans-serif;
            color: #00ff88;
            font-size: 1.1rem;
        }
        #chatbot-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        #chat-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            scrollbar-width: thin;
            scrollbar-color: #00ff88 #2d3748;
        }
        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: #2d3748;
            border-radius: 10px;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background-color: #00ff88;
            border-radius: 10px;
            border: 2px solid #2d3748;
        }

        .chat-message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: 0.75rem;
            word-wrap: break-word;
        }
        .chat-message.user {
            background: #007bff;
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }
        .chat-message.ai {
            background: rgba(0, 255, 136, 0.3);
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }
        .chat-message.loading {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
            align-self: flex-start;
        }

        #chat-input-area {
            display: flex;
            padding: 1rem;
            border-top: 1px solid rgba(0, 255, 136, 0.4);
        }
        #chat-input {
            flex-grow: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.6);
            border-radius: 0.5rem;
            padding: 0.75rem;
            color: white;
            outline: none;
            margin-right: 0.75rem;
        }
        #chat-send-btn {
            background: #00ff88;
            color: #0a0a23;
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #chat-send-btn:hover {
            background: #00e676;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #00ff88;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 0.5rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        @media (max-width: 768px) {
            body {
                scroll-padding-top: 64px; /* Ensure this matches navbar height on mobile */
            }
            .hamburger {
                display: block;
                font-size: calc(1.2rem + 1vw);
                cursor: pointer;
                transition: color 0.3s ease;
            }
            .hamburger.active {
                color: #00ff88;
            }
            .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 64px;
                left: 0;
                background: rgba(0, 0, 0, 0.9);
                width: 100%;
                padding: 1rem;
            }
            .nav-links.active {
                display: flex;
            }
            .nav-item {
                opacity: 0;
                transform: translateX(-20px);
            }
            .nav-links.active .nav-item {
                opacity: 1;
                transform: translateX(0);
                transition: opacity 0.3s ease, transform 0.3s ease;
                transition-delay: calc(0.1s * var(--index));
            }
            .submenu {
                position: static;
                background: rgba(255, 255, 255, 0.1);
                margin-top: 0.5rem;
                transform: none;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.4s ease-in-out;
                opacity: 1; /* Always visible when active on mobile */
                pointer-events: auto;
            }
            .submenu.active {
                max-height: 300px;
            }
            .submenu a {
                opacity: 0;
                transform: translateX(-20px);
            }
            .submenu.active a {
                opacity: 1;
                transform: translateX(0);
                transition: opacity 0.3s ease, transform 0.3s ease;
                transition-delay: calc(0.1s * var(--index));
            }
            .nav-item:hover .submenu {
                display: none; /* Disable hover submenu on mobile */
            }
            .nav-item.active .submenu {
                display: block; /* Show active submenu on mobile */
            }
            .nav-item {
                margin-bottom: 0.5rem;
            }
            .section-title {
                font-size: calc(1.5rem + 1vw);
            }
            .sub-section-title {
                font-size: calc(1rem + 0.5vw);
            }
            .sub-section {
                padding-top: 3rem;
                min-height: 30vh;
            }
            .nav-arrow {
                right: 1rem;
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            #arrow-up {
                bottom: 6rem;
            }
            #arrow-down {
                bottom: 1rem;
            }

            #chatbot-toggle-btn {
                bottom: 1rem;
                left: 1rem;
                width: 50px;
                height: 50px;
                font-size: 1.8rem;
            }
            #chatbot-container {
                width: calc(100% - 2rem);
                height: 400px;
                bottom: 1rem;
                left: 1rem;
            }
        }
        @media (min-width: 769px) {
            .hamburger {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Custom Cursor -->
    <div class="custom-cursor"></div>

    <!-- Custom Modal Structure -->
    <div id="custom-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <p id="modal-message"></p>
            <button id="modal-close-btn">Cerrar</button>
        </div>
    </div>

    <!-- Navbar -->
    <nav class="navbar py-4">
        <canvas class="nav-canvas"></canvas>
        <div class="max-w-7xl mx-auto flex justify-between items-center px-4">
            <h1 class="text-2xl md:text-3xl font-bold gradient-text">Mundos de IA</h1>
            <div class="hamburger text-white"><i class="fas fa-bars"></i></div>
            <div class="nav-links flex gap-4 md:gap-6">
                <div class="nav-item" style="--index: 0;">
                    <a href="#home" class="hover:text-blue-400 text-base md:text-lg"><i class="fas fa-star"></i> Inicio</a>
                    <div class="submenu">
                        <a href="#home-welcome" style="--index: 0;"><i class="fas fa-rocket"></i> Bienvenida</a>
                        <a href="#home-vision" style="--index: 1;"><i class="fas fa-eye"></i> Nuestra Visión</a>
                        <a href="#home-resonance" style="--index: 2;"><i class="fas fa-atom"></i> Resonancia Quiral</a>
                    </div>
                </div>
                <div class="nav-item" style="--index: 1;">
                    <a href="#portfolio" class="hover:text-blue-400 text-base md:text-lg"><i class="fas fa-paint-brush"></i> Creaciones</a>
                    <div class="submenu">
                        <a href="#portfolio-images" style="--index: 0;"><i class="fas fa-image"></i> Imágenes IA</a>
                        <a href="#portfolio-videos" style="--index: 1;"><i class="fas fa-video"></i> Videos IA</a>
                        <a href="#portfolio-poetry" style="--index: 2;"><i class="fas fa-scroll"></i> Poesía IA</a>
                    </div>
                </div>
                <div class="nav-item" style="--index: 2;">
                    <a href="#process" class="hover:text-blue-400 text-base md:text-lg"><i class="fas fa-cogs"></i> Proceso</a>
                    <div class="submenu">
                        <a href="#process-tech" style="--index: 0;"><i class="fas fa-microchip"></i> Tecnología</a>
                        <a href="#process-inspiration" style="--index: 1;"><i class="fas fa-lightbulb"></i> Inspiración</a>
                        <a href="#process-impact" style="--index: 2;"><i class="fas fa-globe"></i> Impacto</a>
                    </div>
                </div>
                <div class="nav-item" style="--index: 3;">
                    <a href="#contact" class="hover:text-blue-400 text-base md:text-lg"><i class="fas fa-portal"></i> Contacto</a>
                    <div class="submenu">
                        <a href="#contact-form" style="--index: 0;"><i class="fas fa-envelope"></i> Formulario</a>
                        <a href="#contact-social" style="--index: 1;"><i class="fas fa-share-alt"></i> Redes Sociales</a>
                        <a href="#contact-newsletter" style="--index: 2;"><i class="fas fa-newspaper"></i> Newsletter</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Section 1: Bienvenida a Mundos de IA -->
    <section id="home" class="section relative">
        <canvas class="section-canvas"></canvas>
        <div class="wave-overlay"></div>
        <div class="pulse-effect"></div>
        <div class="text-center max-w-7xl mx-auto">
            <h1 class="section-title gradient-text">Mundos de IA</h1>
            <div id="home-welcome" class="sub-section mb-4">
                <h3 class="sub-section-title">Bienvenida</h3>
                <p class="text-base md:text-lg max-w-2xl mx-auto">Adéntrate en un cosmos donde la IA da forma a realidades únicas. En Mundos de IA, fusionamos tecnología y creatividad para explorar los límites de la imaginación.</p>
            </div>
            <div id="home-vision" class="sub-section mb-4">
                <h3 class="sub-section-title">Nuestra Visión</h3>
                <p class="text-base md:text-lg max-w-2xl mx-auto">Visualizamos un futuro donde la inteligencia artificial no solo asiste, sino que inspira, conectando mundos a través de pixels, versos y fotogramas generados por algoritmos avanzados.</p>
                <div class="flex flex-col sm:flex-row gap-4 mt-8">
                    <button onclick="scrollToSection('portfolio')" class="bg-transparent border-2 border-blue-400 hover:bg-blue-400 text-white py-2 px-6 rounded-full text-base md:text-lg transform rotate-3 transition duration-300 ease-in-out hover:scale-110">Explorar Creaciones</button>
                    <button onclick="scrollToSection('contact')" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-full text-base md:text-lg transform -rotate-3 transition duration-300 ease-in-out hover:scale-110">Contáctanos</button>
                </div>
            </div>
            <div id="home-resonance" class="sub-section">
                <h3 class="sub-section-title">Resonancia Quiral</h3>
                <p id="chiral-quote" class="text-sm italic max-w-2xl mx-auto mb-4">"Un eco que danza entre las estrellas, uniendo la mente humana con el cosmos."</p>
                <button id="generate-quote-btn" class="bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-full text-sm transition duration-300 ease-in-out hover:scale-105">Nueva Cita</button>
            </div>
        </div>
    </section>

    <!-- Section 2: Galería de Creaciones -->
    <section id="portfolio" class="section">
        <canvas class="section-canvas"></canvas>
        <div class="wave-overlay"></div>
        <div class="pulse-effect"></div>
        <h2 class="section-title text-center">Nuestras Creaciones</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl mx-auto">
            <div id="portfolio-images" class="sub-section card transform rotate-3">
                <canvas id="canvas-images" class="card-canvas"></canvas>
                <h3 class="sub-section-title">Imágenes IA</h3>
                <div class="image-gallery relative w-full max-w-md mx-auto mt-3">
                    <img id="gallery-image" src="https://placehold.co/400x300/007bff/ffffff?text=Galaxia+IA+1" alt="" class="gallery-image w-full rounded-lg shadow-lg">
                    <button id="prev-image" class="gallery-nav-btn left-2"><i class="fas fa-chevron-left"></i></button>
                    <button id="next-image" class="gallery-nav-btn right-2"><i class="fas fa-chevron-right"></i></button>
                </div>
                <p class="mt-3 text-sm md:text-base">Pinturas digitales nacidas de algoritmos complejos, capturando mundos imposibles y emociones abstractas con una paleta de colores vibrante. Explora paisajes cósmicos, criaturas etéreas y arquitecturas futuristas.</p>
            </div>
            <div id="portfolio-videos" class="sub-section card transform -rotate-2">
                <canvas id="canvas-videos" class="card-canvas"></canvas>
                <h3 class="sub-section-title">Videos IA</h3>
                <div class="grid grid-cols-2 gap-4 mt-3">
                    <div class="relative video-preview">
                        <img src="https://placehold.co/200x150/ff00cc/ffffff?text=Video+Preview+1" alt="" class="w-full rounded-lg shadow-lg">
                        <i class="fas fa-play-circle absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-4xl opacity-75"></i>
                    </div>
                    <div class="relative video-preview">
                        <img src="https://placehold.co/200x150/ff00cc/ffffff?text=Video+Preview+2" alt="" class="w-full rounded-lg shadow-lg">
                        <i class="fas fa-play-circle absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-4xl opacity-75"></i>
                    </div>
                    <div class="relative video-preview">
                        <img src="https://placehold.co/200x150/ff00cc/ffffff?text=Video+Preview+3" alt="" class="w-full rounded-lg shadow-lg">
                        <i class="fas fa-play-circle absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-4xl opacity-75"></i>
                    </div>
                    <div class="relative video-preview">
                        <img src="https://placehold.co/200x150/ff00cc/ffffff?text=Video+Preview+4" alt="" class="w-full rounded-lg shadow-lg">
                        <i class="fas fa-play-circle absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white text-4xl opacity-75"></i>
                    </div>
                </div>
                <p class="mt-3 text-sm md:text-base">Narrativas visuales que desafían la realidad, tejidas por redes neuronales que generan secuencias dinámicas y experiencias cinematográficas únicas. Sumérgete en mundos en movimiento creados íntegramente por IA.</p>
            </div>
            <div id="portfolio-poetry" class="sub-section card transform rotate-2">
                <canvas id="canvas-poetry" class="card-canvas"></canvas>
                <h3 class="sub-section-title">Poesía IA</h3>
                <p class="italic text-sm">"Versos que resuenan con el latido del universo, forjados en la fragua de la lógica y la emoción artificial."</p>
                <p class="mt-3 text-sm md:text-base">Textos que exploran la condición humana, el cosmos y la existencia, con una profundidad y originalidad sorprendentes. Desde odas a la tecnología hasta baladas sobre el alma digital, cada poema es una ventana a nuevas perspectivas.</p>
                <p class="mt-2 text-xs italic opacity-80">"El código susurra, la mente escucha, un puente entre el silencio y la luz."</p>
            </div>
        </div>
    </section>

    <!-- Section 3: Cómo lo Hacemos -->
    <section id="process" class="section">
        <canvas class="section-canvas"></canvas>
        <div class="wave-overlay"></div>
        <div class="pulse-effect"></div>
        <h2 class="section-title text-center">Cómo lo Hacemos</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl mx-auto">
            <div id="process-tech" class="sub-section card transform rotate-3">
                <h3 class="sub-section-title">Tecnología</h3>
                <p class="text-sm md:text-base">Empleamos modelos de inteligencia artificial de vanguardia, incluyendo redes generativas adversarias (GANs) y transformadores, para crear obras que trascienden la imaginación humana. Nuestra infraestructura de procesamiento de alto rendimiento permite generar contenido complejo con una eficiencia sin precedentes.</p>
            </div>
            <div id="process-inspiration" class="sub-section card transform -rotate-2">
                <h3 class="sub-section-title">Inspiración</h3>
                <p class="text-sm md:text-base">Nuestras obras nacen en la intersección del arte, la ciencia y la filosofía, inspiradas por la vasta complejidad del universo y la infinita creatividad del pensamiento humano. Cada creación es un diálogo entre la lógica algorítmica y la chispa de la imaginación.</p>
            </div>
            <div id="process-impact" class="sub-section card transform rotate-2">
                <h3 class="sub-section-title">Impacto</h3>
                <p class="text-sm md:text-base">Creemos en el poder de la IA para transformar percepciones, desafiar lo establecido y conectar comunidades globales a través de experiencias artísticas y narrativas innovadoras. Nuestro objetivo es abrir nuevas avenidas para la expresión creativa y el entendimiento.</p>
            </div>
        </div>
    </section>

    <!-- Section 4: Únete al Universo -->
    <section id="contact" class="section">
        <canvas class="section-canvas"></canvas>
        <div class="wave-overlay"></div>
        <div class="pulse-effect"></div>
        <h2 class="section-title text-center">Únete al Universo</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-7xl mx-auto">
            <div id="contact-form" class="sub-section card transform rotate-3">
                <h3 class="sub-section-title">Contáctanos</h3>
                <p class="text-sm md:text-base">Explora colaboraciones o comparte tu visión del universo digital. Estamos ansiosos por escuchar tus ideas y construir el futuro juntos.</p>
                <form id="contact-form-element" action="https://formspree.io/f/mrblgljg" method="POST">
                    <input type="text" name="name" placeholder="Nombre" class="w-full p-2 mb-3 bg-transparent border border-blue-400 rounded text-white text-sm md:text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="email" name="_replyto" placeholder="Email" class="w-full p-2 mb-3 bg-transparent border border-blue-400 rounded text-white text-sm md:text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <textarea name="message" placeholder="Mensaje" class="w-full p-2 bg-transparent border border-blue-400 rounded text-white text-sm md:text-base h-24 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-full mt-3 transform rotate-2 text-sm md:text-base transition duration-300 ease-in-out hover:scale-105">Enviar</button>
                </form>
            </div>
            <div id="contact-social" class="sub-section card transform -rotate-2">
                <h3 class="sub-section-title">Redes Sociales</h3>
                <p class="text-sm md:text-base">Síguenos en nuestras plataformas para unirte a nuestra comunidad de soñadores digitales y estar al tanto de las últimas creaciones, eventos y novedades de Mundos de IA.</p>
                <div class="flex gap-4 mt-3">
                    <a href="#" class="text-blue-400 hover:text-blue-300 transform rotate-3 text-sm md:text-base transition duration-300 ease-in-out hover:scale-110"><i class="fab fa-twitter"></i> Twitter</a>
                    <a href="#" class="text-blue-400 hover:text-blue-300 transform -rotate-3 text-sm md:text-base transition duration-300 ease-in-out hover:scale-110"><i class="fab fa-instagram"></i> Instagram</a>
                    <a href="#" class="text-blue-400 hover:text-blue-300 transform rotate-3 text-sm md:text-base transition duration-300 ease-in-out hover:scale-110"><i class="fab fa-youtube"></i> YouTube</a>
                </div>
            </div>
            <div id="contact-newsletter" class="sub-section card transform rotate-2">
                <h3 class="sub-section-title">Newsletter</h3>
                <p class="text-sm md:text-base">Suscríbete a nuestro newsletter para recibir directamente en tu bandeja de entrada nuestras últimas creaciones, noticias y eventos exclusivos. No te pierdas ninguna actualización de nuestro universo.</p>
                <form id="newsletter-form">
                    <input type="email" placeholder="Tu email" class="w-full p-2 mb-3 bg-transparent border border-blue-400 rounded text-white text-sm md:text-base focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-full transform -rotate-2 text-sm md:text-base transition duration-300 ease-in-out hover:scale-105">Suscribirse</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Floating Navigation Arrows -->
    <div id="arrow-up" class="nav-arrow"><i class="fas fa-chevron-up"></i></div>
    <div id="arrow-down" class="nav-arrow"><i class="fas fa-chevron-down"></i></div>

    <!-- Chatbot Toggle Button -->
    <div id="chatbot-toggle-btn" class="flex items-center justify-center">
        <i class="fas fa-eye"></i> <!-- Changed to eye icon -->
    </div>

    <!-- Chatbot Container -->
    <div id="chatbot-container">
        <div id="chatbot-header">
            <span>Oráculo IA</span> <!-- Chatbot name -->
            <button id="chatbot-close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div id="chat-messages">
            <!-- Initial welcome message will be added by JS -->
        </div>
        <div id="chat-input-area">
            <input type="text" id="chat-input" placeholder="Escribe tu mensaje..." class="flex-grow">
            <button id="chat-send-btn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        // Tone.js setup
        let synth;
        let pingPong;
        let ambientSynth;

        async function initAudio() {
            await Tone.start();
            synth = new Tone.PolySynth(Tone.Synth, {
                oscillator: { type: "sine" },
                envelope: {
                    attack: 0.005,
                    decay: 0.1,
                    sustain: 0.2,
                    release: 0.5,
                }
            }).toDestination();

            pingPong = new Tone.PingPongDelay("4n", 0.2).toDestination();
            ambientSynth = new Tone.FMSynth({
                harmonicity: 3.0,
                modulationIndex: 10,
                envelope: {
                    attack: 2,
                    decay: 2,
                    sustain: 0.5,
                    release: 5
                },
                modulation: {
                    type: "sine"
                },
                modulationEnvelope: {
                    attack: 2,
                    decay: 0.1,
                    sustain: 1,
                    release: 0.5
                }
            }).connect(pingPong).toDestination();
            ambientSynth.volume.value = -20; // Keep ambient sound subtle
            ambientSynth.triggerAttackRelease("C3", "8n", "+0.5"); // Play a note to start ambient sound
        }

        // Custom Modal Functions
        function showModal(title, message) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('custom-modal-overlay').classList.add('active');
            if (synth) synth.triggerAttackRelease("C4", "8n"); // Sound for modal
        }

        function hideModal() {
            document.getElementById('custom-modal-overlay').classList.remove('active');
        }

        document.getElementById('modal-close-btn').addEventListener('click', hideModal);
        document.getElementById('custom-modal-overlay').addEventListener('click', (e) => {
            if (e.target.id === 'custom-modal-overlay') {
                hideModal();
            }
        });

        // Smooth Scroll with Precise Centering and Snapping
        const sections = gsap.utils.toArray('.section');
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            const navbarHeight = document.querySelector('.navbar').offsetHeight; // Get current navbar height
            gsap.to(window, {
                scrollTo: {
                    y: element,
                    offsetY: navbarHeight // Use navbarHeight as offset
                },
                duration: 0.8,
                ease: 'power2.out',
                onComplete: () => {
                    if (synth) synth.triggerAttackRelease("G4", "8n"); // Sound for scroll
                }
            });
        }

        // Hamburger Menu
        const hamburger = document.querySelector('.hamburger');
        const navLinks = document.querySelector('.nav-links');
        
        // Ensure menu is closed by default on mobile
        if (window.innerWidth <= 768) {
            navLinks.classList.remove('active');
            hamburger.classList.remove('active');
        }

        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navLinks.classList.toggle('active');
            if (synth) synth.triggerAttackRelease("C5", "16n"); // Sound for menu toggle
        });
        hamburger.addEventListener('touchstart', (e) => {
            e.preventDefault();
            hamburger.classList.toggle('active');
            navLinks.classList.toggle('active');
            if (synth) synth.triggerAttackRelease("C5", "16n"); // Sound for menu toggle
        });

        // Submenu toggle on mobile
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            const mainLink = item.querySelector('a');
            const submenu = item.querySelector('.submenu');
            mainLink.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    e.preventDefault(); // Prevent default scroll for main link on mobile as we handle submenu toggle
                    navItems.forEach(i => {
                        if (i !== item) {
                            i.classList.remove('active');
                            i.querySelector('.submenu').classList.remove('active');
                        }
                    });
                    item.classList.toggle('active');
                    submenu.classList.toggle('active');
                    if (synth) synth.triggerAttackRelease("D5", "16n"); // Sound for submenu toggle
                }
            });
            mainLink.addEventListener('touchstart', (e) => {
                if (window.innerWidth <= 768) {
                    e.preventDefault();
                    navItems.forEach(i => {
                        if (i !== item) {
                            i.classList.remove('active');
                            i.querySelector('.submenu').classList.remove('active');
                        }
                    });
                    item.classList.toggle('active');
                    submenu.classList.toggle('active');
                    if (synth) synth.triggerAttackRelease("D5", "16n"); // Sound for submenu toggle
                }
            });
        });

        // Auto-close menu on mobile when clicking any link within nav-links (main or submenu)
        const allNavLinksInMenu = document.querySelectorAll('.nav-links a');
        allNavLinksInMenu.forEach(link => {
            link.addEventListener('click', (e) => {
                if (window.innerWidth <= 768) {
                    // Only prevent default if it's a submenu link, as main links already have it handled for toggle
                    if (link.closest('.submenu')) {
                        e.preventDefault(); 
                    }
                    
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                    navItems.forEach(item => {
                        item.classList.remove('active');
                        item.querySelector('.submenu').classList.remove('active');
                    });
                    // Scroll after menus are closed
                    scrollToSection(link.getAttribute('href').substring(1));
                }
            });
            link.addEventListener('touchstart', (e) => {
                if (window.innerWidth <= 768) {
                    if (link.closest('.submenu')) {
                        e.preventDefault();
                    }
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                    navItems.forEach(item => {
                        item.classList.remove('active');
                        item.querySelector('.submenu').classList.remove('active');
                    });
                    scrollToSection(link.getAttribute('href').substring(1));
                }
            });
        });


        // Navbar shrink on scroll
        window.addEventListener('scroll', () => {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // GSAP Animations with Dynamic Transitions
        gsap.registerPlugin(ScrollTrigger, ScrollToPlugin);

        // Section-specific animations
        gsap.utils.toArray('.section').forEach((section, index) => {
            const cards = section.querySelectorAll('.card');
            const title = section.querySelector('.section-title');
            const waveOverlay = section.querySelector('.wave-overlay');
            const pulseEffect = section.querySelector('.pulse-effect');

            // Background color transition
            gsap.to(section, {
                background: index === 0 ? 'linear-gradient(135deg, #0a0a23, #1e3a8a)' :
                               index === 1 ? 'linear-gradient(135deg, #1e3a8a, #4c1d95)' :
                               index === 2 ? 'linear-gradient(135deg, #4c1d95, #831843)' :
                               'linear-gradient(135deg, #831843, #0a0a23)',
                duration: 1,
                scrollTrigger: {
                    trigger: section,
                    start: 'top center',
                    end: 'bottom center',
                    scrub: true
                }
            });

            // Wave effect on section enter
            gsap.to(waveOverlay, {
                opacity: 0.6,
                scale: 2,
                duration: 2,
                ease: 'power2.out',
                scrollTrigger: {
                    trigger: section,
                    start: 'top 80%',
                    toggleActions: 'play none none reverse'
                }
            });

            // Pulse effect with starry burst
            gsap.to(pulseEffect, {
                scale: 4,
                opacity: 0,
                duration: 2.5,
                ease: 'power1.out',
                scrollTrigger: {
                    trigger: section,
                    start: 'top 80%',
                    toggleActions: 'play none none reverse'
                }
            });

            // Title animation with elastic effect
            gsap.from(title, {
                opacity: 0,
                scale: 0.7,
                y: 80,
                rotate: index % 2 === 0 ? -6 : 6,
                duration: 1.5,
                ease: 'elastic.out(1, 0.4)',
                scrollTrigger: {
                    trigger: section,
                    start: 'top 80%',
                    toggleActions: 'play none none reverse'
                }
            });

            // Cards animation with dynamic rotation
            gsap.from(cards, {
                opacity: 0,
                y: 60,
                rotate: index % 2 === 0 ? 6 : -6,
                stagger: 0.3,
                duration: 1.2,
                ease: 'power3.out',
                scrollTrigger: {
                    trigger: section,
                    start: 'top 80%',
                    toggleActions: 'play none none reverse'
                }
            });
        });

        // Particle Background for Navbar and Sections (excluding home for Three.js)
        const canvases = document.querySelectorAll('.section-canvas:not(#home .section-canvas), .nav-canvas');
        canvases.forEach(canvas => {
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = canvas.classList.contains('nav-canvas') ? 64 : window.innerHeight;

            const particles = [];
            const mouse = { x: null, y: null };
            for (let i = 0; i < (canvas.classList.contains('nav-canvas') ? 10 : 30); i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 3 + 1,
                    baseRadius: Math.random() * 3 + 1,
                    vx: (Math.random() - 0.5) * 0.2 - 0.1,
                    vy: (Math.random() - 0.5) * 0.2 - 0.1,
                    color: `hsl(${Math.random() * 360}, 70%, 70%)`
                });
            }

            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                mouse.x = e.clientX - rect.left;
                mouse.y = e.clientY - rect.top;
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                mouse.x = touch.clientX - rect.left;
                mouse.y = touch.clientY - rect.top;
            });

            function animateParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    if (mouse.x && mouse.y) {
                        const dx = mouse.x - p.x;
                        const dy = mouse.y - p.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 150) {
                            p.radius = p.baseRadius * 2.5;
                            p.vx += dx * 0.003; // Reduced attraction strength
                            p.vy += dy * 0.003;
                        } else {
                            p.radius = p.baseRadius;
                        }
                    }

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();
                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                });

                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 100) {
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = `rgba(0, 255, 136, ${1 - distance / 100})`;
                            ctx.stroke();
                        }
                    }
                }

                requestAnimationFrame(animateParticles);
            }
            animateParticles();
        });

        // Three.js Background for Home Section
        const homeCanvas = document.querySelector('#home .section-canvas');
        let scene, camera, renderer, particles3D, mouse3D = new THREE.Vector2();

        function initThreeJS() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, homeCanvas.clientWidth / homeCanvas.clientHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: homeCanvas, alpha: true });
            renderer.setSize(homeCanvas.clientWidth, homeCanvas.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Particles
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const colors = [];
            const sizes = [];

            for (let i = 0; i < 500; i++) {
                vertices.push(
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200
                );
                colors.push(Math.random(), Math.random(), Math.random());
                sizes.push(Math.random() * 5 + 2);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            geometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));

            const material = new THREE.PointsMaterial({
                size: 5,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            particles3D = new THREE.Points(geometry, material);
            scene.add(particles3D);

            camera.position.z = 100;

            // Resize handler for Three.js
            window.addEventListener('resize', () => {
                camera.aspect = homeCanvas.clientWidth / homeCanvas.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(homeCanvas.clientWidth, homeCanvas.clientHeight);
            });

            homeCanvas.addEventListener('mousemove', (event) => {
                mouse3D.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse3D.y = -(event.clientY / window.innerHeight) * 2 + 1;
            });
            homeCanvas.addEventListener('touchmove', (event) => {
                event.preventDefault();
                const touch = event.touches[0];
                mouse3D.x = (touch.clientX / window.innerWidth) * 2 - 1;
                mouse3D.y = -(touch.clientY / window.innerHeight) * 2 + 1;
            });
        }

        function animateThreeJS() {
            requestAnimationFrame(animateThreeJS);

            if (particles3D) {
                particles3D.rotation.x += 0.0005;
                particles3D.rotation.y += 0.0008;

                // Simple camera movement based on mouse
                camera.position.x += (mouse3D.x * 50 - camera.position.x) * 0.05;
                camera.position.y += (mouse3D.y * 50 - camera.position.y) * 0.05;
                camera.lookAt(scene.position);
            }

            renderer.render(scene, camera);
        }

        // Form Validation with Animation
        document.getElementById('contact-form-element').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const name = form.querySelector('input[name="name"]').value;
            const email = form.querySelector('input[name="_replyto"]').value;
            const message = form.querySelector('textarea[name="message"]').value;

            if (name && email && message) {
                // Use Formspree to submit
                const formData = new FormData(form);
                try {
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    if (response.ok) {
                        gsap.to(form, {
                            opacity: 0,
                            y: -30,
                            rotate: 6,
                            duration: 0.6,
                            onComplete: () => {
                                showModal('¡Mensaje Enviado!', 'Gracias por contactarnos. Te responderemos pronto.');
                                gsap.to(form, { opacity: 1, y: 0, rotate: 3, duration: 0.6 });
                                form.reset();
                            }
                        });
                    } else {
                        const data = await response.json();
                        if (data.errors) {
                            showModal('Error al Enviar', data.errors.map(error => error.message).join(', '));
                        } else {
                            showModal('Error al Enviar', 'Hubo un problema al enviar tu mensaje. Inténtalo de nuevo.');
                        }
                    }
                } catch (error) {
                    console.error('Error de red o al enviar el formulario:', error);
                    showModal('Error de Conexión', 'No se pudo conectar con el servidor. Por favor, revisa tu conexión a internet.');
                }
            } else {
                showModal('Error', 'Por favor, completa todos los campos.');
            }
        });


        document.getElementById('newsletter-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const form = e.target;
            const email = form.querySelector('input[type="email"]').value;

            if (email) {
                gsap.to(form, {
                    opacity: 0,
                    y: -30,
                    rotate: -6,
                    duration: 0.6,
                    onComplete: () => {
                        showModal('¡Suscripción Exitosa!', 'Te has suscrito al newsletter de Mundos de IA. ¡Bienvenido!');
                        gsap.to(form, { opacity: 1, y: 0, rotate: 2, duration: 0.6 });
                        form.reset();
                    }
                });
            } else {
                showModal('Error', 'Por favor, introduce tu email.');
            }
        });

        // Chiral Resonance Quotes
        const chiralQuotes = [
            "Un eco que danza entre las estrellas, uniendo la mente humana con el cosmos.",
            "En la sinfonía del código, encontramos la poesía del universo digital.",
            "Cada algoritmo es un pincel, cada dato un color en el lienzo de la realidad.",
            "La IA no imita la vida, la expande hacia horizontes inexplorados.",
            "Donde la lógica se encuentra con la intuición, nacen los verdaderos mundos de IA."
        ];
        const chiralQuoteElement = document.getElementById('chiral-quote');
        const generateQuoteBtn = document.getElementById('generate-quote-btn');

        generateQuoteBtn.addEventListener('click', () => {
            const randomIndex = Math.floor(Math.random() * chiralQuotes.length);
            gsap.to(chiralQuoteElement, {
                opacity: 0,
                y: -10,
                duration: 0.3,
                onComplete: () => {
                    chiralQuoteElement.textContent = chiralQuotes[randomIndex];
                    gsap.fromTo(chiralQuoteElement,
                        { opacity: 0, y: 10 },
                        { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' }
                    );
                    if (synth) synth.triggerAttackRelease("E5", "16n"); // Sound for new quote
                }
            });
        });

        // Custom Cursor Effect
        const customCursor = document.querySelector('.custom-cursor');
        document.body.addEventListener('mousemove', (e) => {
            gsap.to(customCursor, {
                x: e.clientX,
                y: e.clientY,
                duration: 0.1,
                ease: 'Power2.easeOut'
            });
        });
        document.body.addEventListener('mouseenter', () => {
            gsap.to(customCursor, { opacity: 0.6, scale: 1, duration: 0.2 });
        });
        document.body.addEventListener('mouseleave', () => {
            gsap.to(customCursor, { opacity: 0, scale: 0, duration: 0.2 });
        });
        document.body.addEventListener('mousedown', () => {
            customCursor.classList.add('active');
            if (synth) synth.triggerAttackRelease("C4", "32n"); // Click sound
        });
        document.body.addEventListener('mouseup', () => {
            customCursor.classList.remove('active');
        });

        // Floating Navigation Arrows Logic
        const arrowUp = document.getElementById('arrow-up');
        const arrowDown = document.getElementById('arrow-down');
        const sectionElements = gsap.utils.toArray('.section'); // Get actual section elements

        function updateArrowsVisibility() {
            const currentScrollY = window.scrollY;
            const windowHeight = window.innerHeight;
            let currentSectionIndex = -1;

            // Determine which section is currently in view (or mostly in view)
            for (let i = 0; i < sectionElements.length; i++) {
                const rect = sectionElements[i].getBoundingClientRect();
                // Check if the section is at least partially visible within the viewport
                if (rect.top <= windowHeight / 2 && rect.bottom >= windowHeight / 2) {
                    currentSectionIndex = i;
                    break;
                }
            }

            if (currentSectionIndex === 0) {
                arrowUp.classList.remove('visible');
            } else {
                arrowUp.classList.add('visible');
            }

            if (currentSectionIndex === sectionElements.length - 1) {
                arrowDown.classList.remove('visible');
            } else {
                arrowDown.classList.add('visible');
            }
        }

        arrowUp.addEventListener('click', () => {
            const currentScrollY = window.scrollY;
            let targetSectionIndex = -1;

            for (let i = 0; i < sectionElements.length; i++) {
                // Find the first section that is mostly above the current view
                if (sectionElements[i].offsetTop < currentScrollY - (window.innerHeight * 0.1)) {
                    targetSectionIndex = i;
                } else {
                    break;
                }
            }
            if (targetSectionIndex !== -1) {
                scrollToSection(sectionElements[targetSectionIndex].id);
            } else if (currentScrollY > 0) { // If near top, go to the very top
                 scrollToSection(sectionElements[0].id);
            }
        });

        arrowDown.addEventListener('click', () => {
            const currentScrollY = window.scrollY;
            let targetSectionIndex = -1;

            for (let i = 0; i < sectionElements.length; i++) {
                // Find the first section that is mostly below the current view
                if (sectionElements[i].offsetTop > currentScrollY + (window.innerHeight * 0.1)) {
                    targetSectionIndex = i;
                    break;
                }
            }
            if (targetSectionIndex !== -1) {
                scrollToSection(sectionElements[targetSectionIndex].id);
            } else if (currentScrollY + window.innerHeight < document.body.scrollHeight) { // If near bottom, go to the very bottom
                scrollToSection(sectionElements[sectionElements.length - 1].id);
            }
        });


        // Update arrows on scroll and resize
        window.addEventListener('scroll', updateArrowsVisibility);
        window.addEventListener('resize', updateArrowsVisibility);
        
        // Initial call to set arrow visibility
        updateArrowsVisibility();


        // Particle Background for Cards
        function initCardCanvas(canvasId, particleCount, lineColor, particleColor) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return; // Ensure canvas exists

            const ctx = canvas.getContext('2d');
            let particles = [];
            let animationFrameId;

            function resizeCanvas() {
                const parent = canvas.parentElement;
                canvas.width = parent.clientWidth;
                canvas.height = parent.clientHeight;
                particles = []; // Re-initialize particles on resize
                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        radius: Math.random() * 1.5 + 0.5,
                        vx: (Math.random() - 0.5) * 0.5,
                        vy: (Math.random() - 0.5) * 0.5,
                        color: particleColor || `hsl(${Math.random() * 360}, 70%, 70%)`
                    });
                }
            }

            resizeCanvas(); // Initial resize
            window.addEventListener('resize', resizeCanvas); // Listen for resize events

            function animateCardParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                particles.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.fill();

                    p.x += p.vx;
                    p.y += p.vy;

                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                });

                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 80) { // Connect particles if close
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = lineColor || `rgba(0, 255, 136, ${0.5 - distance / 80})`;
                            ctx.stroke();
                        }
                    }
                }
                animationFrameId = requestAnimationFrame(animateCardParticles);
            }
            animateCardParticles();
        }

        // Image Gallery Logic
        const images = [
            "https://placehold.co/400x300/007bff/ffffff?text=Galaxia+IA+1",
            "https://placehold.co/400x300/007bff/ffffff?text=Paisaje+IA+2",
            "https://placehold.co/400x300/007bff/ffffff?text=Criatura+IA+3",
            "https://placehold.co/400x300/007bff/ffffff?text=Ciudad+IA+4",
            "https://placehold.co/400x300/007bff/ffffff?text=Abstracto+IA+5",
            "https://placehold.co/400x300/007bff/ffffff?text=Futurista+IA+6"
        ];
        let currentImageIndex = 0;
        const galleryImage = document.getElementById('gallery-image');
        const prevImageBtn = document.getElementById('prev-image');
        const nextImageBtn = document.getElementById('next-image');

        function updateGalleryImage() {
            gsap.to(galleryImage, {
                opacity: 0,
                scale: 0.8,
                duration: 0.3,
                onComplete: () => {
                    galleryImage.src = images[currentImageIndex];
                    gsap.fromTo(galleryImage,
                        { opacity: 0, scale: 1.2 },
                        { opacity: 1, scale: 1, duration: 0.5, ease: 'power2.out' }
                    );
                    if (synth) synth.triggerAttackRelease("A4", "32n"); // Sound for image change
                }
            });
        }

        prevImageBtn.addEventListener('click', () => {
            currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
            updateGalleryImage();
        });

        nextImageBtn.addEventListener('click', () => {
            currentImageIndex = (currentImageIndex + 1) % images.length;
            updateGalleryImage();
        });


        // Initialize card canvases
        initCardCanvas('canvas-images', 40, 'rgba(0, 123, 255, 0.4)', 'rgba(0, 123, 255, 0.8)'); // Blueish
        initCardCanvas('canvas-videos', 50, 'rgba(255, 0, 204, 0.4)', 'rgba(255, 0, 204, 0.8)'); // Pinkish
        initCardCanvas('canvas-poetry', 30, 'rgba(0, 255, 136, 0.4)', 'rgba(0, 255, 136, 0.8)'); // Greenish

        // Initialize audio context on first user interaction
        document.body.addEventListener('click', initAudio, { once: true });
        document.body.addEventListener('touchstart', initAudio, { once: true });

        // Initialize Three.js scene
        initThreeJS();
        animateThreeJS();

        // Chatbot Logic
        const chatbotToggleBtn = document.getElementById('chatbot-toggle-btn');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotCloseBtn = document.getElementById('chatbot-close-btn');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');

        // Static knowledge base about the website content
        const pageContentKnowledge = {
            home: {
                title: "Sección Inicio",
                content: "Bienvenida a Mundos de IA: Adéntrate en un cosmos donde la IA da forma a realidades únicas. Fusionamos tecnología y creatividad para explorar los límites de la imaginación. Nuestra Visión: Visualizamos un futuro donde la inteligencia artificial no solo asiste, sino que inspira, conectando mundos a través de pixels, versos y fotogramas generados por algoritmos avanzados. Resonancia Quiral: Un eco que danza entre las estrellas, uniendo la mente humana con el cosmos. Frases inspiradoras generadas por IA."
            },
            portfolio: {
                title: "Sección Creaciones",
                content: "Nuestras Creaciones: Galería de obras de arte generadas por IA. Imágenes IA: Pinturas digitales nacidas de algoritmos complejos, capturando mundos imposibles y emociones abstractas. Videos IA: Narrativas visuales que desafían la realidad, tejidas por redes neuronales que generan secuencias dinámicas y experiencias cinematográficas únicas. Poesía IA: Textos que exploran la condición humana, el cosmos y la existencia, con una profundidad y originalidad sorprendentes. Desde odas a la tecnología hasta baladas sobre el alma digital."
            },
            process: {
                title: "Sección Proceso",
                content: "Cómo lo Hacemos: Tecnología: Empleamos modelos de inteligencia artificial de vanguardia, incluyendo redes generativas adversarias (GANs) y transformadores, para crear obras que trascienden la imaginación humana. Nuestra infraestructura de procesamiento de alto rendimiento permite generar contenido complejo con una eficiencia sin precedentes. Inspiración: Nuestras obras nacen en la intersección del arte, la ciencia y la filosofía, inspiradas por la vasta complejidad del universo y la infinita creatividad del pensamiento humano. Cada creación es un diálogo entre la lógica algorítmica y la chispa de la imaginación. Impacto: Creemos en el poder de la IA para transformar percepciones, desafiar lo establecido y conectar comunidades globales a través de experiencias artísticas y narrativas innovadoras. Nuestro objetivo es abrir nuevas avenidas para la expresión creativa y el entendimiento."
            },
            contact: {
                title: "Sección Contacto",
                content: "Únete al Universo: Contáctanos: Explora colaboraciones o comparte tu visión del universo digital. Redes Sociales: Síguenos en nuestras plataformas (Twitter, Instagram, YouTube) para unirte a nuestra comunidad de soñadores digitales. Newsletter: Suscríbete para recibir nuestras últimas creaciones, noticias y eventos exclusivos."
            }
        };

        let chatHistory = []; // Start with an empty history, initial greeting handled by JS

        // Function to get the content of the currently visible section
        function getCurrentlyVisibleSectionContent() {
            let visibleSectionContent = "";
            const navbarHeight = document.querySelector('.navbar').offsetHeight;

            for (let i = 0; i < sectionElements.length; i++) {
                const section = sectionElements[i];
                const rect = section.getBoundingClientRect();
                // A section is considered "visible" if its top is within the viewport
                // and it's not entirely below the bottom of the viewport.
                // We also account for the navbar height.
                if (rect.top < window.innerHeight - navbarHeight && rect.bottom > navbarHeight) {
                    const sectionId = section.id;
                    if (pageContentKnowledge[sectionId]) {
                        visibleSectionContent = pageContentKnowledge[sectionId].content;
                        break; // Found the most relevant section
                    }
                }
            }
            return visibleSectionContent;
        }

        // Function to add message to chat display
        function addMessage(sender, text, isLoading = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message');
            messageDiv.classList.add(sender);
            const pElement = document.createElement('p'); // Create a p tag for text
            messageDiv.appendChild(pElement); // Append p tag to message div
            
            if (isLoading) {
                messageDiv.classList.add('loading');
                const spinner = document.createElement('span');
                spinner.classList.add('spinner');
                messageDiv.appendChild(spinner);
            }
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll to bottom
            return pElement; // Return the p element to type into
        }

        // Typewriter effect function
        function typewriterEffect(element, text, delay = 10) { // Reduced delay for faster typing
            let i = 0;
            element.textContent = ''; // Clear previous text
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    chatMessages.scrollTop = chatMessages.scrollHeight; // Keep scrolling
                    setTimeout(type, delay);
                } else {
                    // Remove spinner if it's a loading message that finished typing
                    const parentDiv = element.closest('.chat-message.loading');
                    if (parentDiv) {
                        parentDiv.classList.remove('loading');
                        const spinner = parentDiv.querySelector('.spinner');
                        if (spinner) spinner.remove();
                    }
                }
            }
            type();
        }

        // Function to send message to LLM
        async function sendMessageToLLM(message) {
            addMessage('user', message);
            chatInput.value = ''; // Clear input

            // Add user message to history
            chatHistory.push({ role: "user", parts: [{ text: message }] });

            const loadingPElement = addMessage('ai', 'Escribiendo...', true); // Get the p element for loading text

            try {
                const currentSectionContent = getCurrentlyVisibleSectionContent();
                let promptWithContext = message;

                if (currentSectionContent) {
                    promptWithContext = `El usuario está viendo la siguiente información en la página: "${currentSectionContent}". Basado en esto y en la conversación, responde a la siguiente pregunta del usuario: "${message}"`;
                } else {
                    // Fallback to general site knowledge if no specific section context
                    promptWithContext = `El usuario está en la página "Mundos de IA", que trata sobre arte y tecnología de IA. Aquí hay un resumen general de la página: ${Object.values(pageContentKnowledge).map(s => s.content).join(' ')}. Responde a la siguiente pregunta del usuario: "${message}"`;
                }

                const payload = { 
                    contents: [
                        { role: "user", parts: [{ text: promptWithContext }] }
                    ]
                };

                // If chatHistory is too long, truncate it or summarize. For now, we'll just send the last few turns.
                // Or, we can send the full chatHistory as the main contents, and prepend the context to the *latest* user message.
                // Let's try prepending context to the latest message in chatHistory for better conversational flow.
                const fullPayloadContents = [...chatHistory];
                // Replace the last user message with the contextualized one
                fullPayloadContents[fullPayloadContents.length - 1] = { role: "user", parts: [{ text: promptWithContext }] };


                const apiKey = ""; // Canvas will automatically provide this
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: fullPayloadContents }) // Send the modified history
                });

                const result = await response.json();
                let aiResponseText = 'Lo siento, no pude generar una respuesta en este momento.';

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    aiResponseText = result.candidates[0].content.parts[0].text;
                }

                // Start typewriter effect for the AI response
                typewriterEffect(loadingPElement, aiResponseText);

                // Add AI response to history after typing is complete (or immediately if not using typewriter for history)
                chatHistory.push({ role: "model", parts: [{ text: aiResponseText }] });

                if (synth) synth.triggerAttackRelease("F4", "16n"); // Sound for AI message received

            } catch (error) {
                console.error('Error al llamar a la API de Gemini:', error);
                loadingPElement.textContent = 'Error: No se pudo conectar con la IA. Inténtalo de nuevo.'; // Update the p element directly
                const parentDiv = loadingPElement.closest('.chat-message.loading');
                if (parentDiv) {
                    parentDiv.classList.remove('loading');
                    const spinner = parentDiv.querySelector('.spinner');
                    if (spinner) spinner.remove();
                }
            } finally {
                chatMessages.scrollTop = chatMessages.scrollHeight; // Ensure scroll to bottom after response
            }
        }

        // Event listeners for chatbot
        chatbotToggleBtn.addEventListener('click', () => {
            const isActive = chatbotContainer.classList.toggle('active');
            if (isActive && chatHistory.length === 0) { // Only add welcome if chat is empty and just opened
                typewriterEffect(addMessage('ai', '', true), '¡Hola! Soy el Oráculo IA, tu asistente virtual en Mundos de IA. ¿En qué puedo ayudarte hoy?'); // Use typewriter for initial message
                chatHistory.push({ role: "model", parts: [{ text: "¡Hola! Soy el Oráculo IA, tu asistente virtual en Mundos de IA. ¿En qué puedo ayudarte hoy?" }] });
            }
            if (synth) synth.triggerAttackRelease("C5", "16n"); // Sound for chatbot toggle
        });

        chatbotCloseBtn.addEventListener('click', () => {
            chatbotContainer.classList.remove('active');
            if (synth) synth.triggerAttackRelease("C5", "16n"); // Sound for chatbot toggle
        });

        chatSendBtn.addEventListener('click', () => {
            const message = chatInput.value.trim();
            if (message) {
                sendMessageToLLM(message);
                if (synth) synth.triggerAttackRelease("E5", "32n"); // Sound for sending message
            }
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const message = chatInput.value.trim();
                if (message) {
                    sendMessageToLLM(message);
                    if (synth) synth.triggerAttackRelease("E5", "32n"); // Sound for sending message
                }
            }
        });

        // Initial welcome message for chatbot when it's opened for the first time.
        // This is now handled within the chatbotToggleBtn click listener.


    </script>
</body>
</html>
